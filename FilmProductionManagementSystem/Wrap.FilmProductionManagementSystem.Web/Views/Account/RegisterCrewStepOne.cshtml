@using Wrap.ViewModels.LoginAndRegistration
@using static Wrap.GCommon.ApplicationConstants;

@model CrewRegistrationStepOneInputModel

@{
    ViewData["Title"] = "Join as Filmmaker";
}

<link rel="stylesheet" href="~/css/registration.css" asp-append-version="true" />

<section class="container-fluid home-hero" xmlns="http://www.w3.org/1999/html">
<div class="registration-container">
    <div class="registration-card">
        <!-- Header -->
        <div class="registration-header">
            <h2 class="text-center">üé¨ Join as <span class="text-wrap-red">Filmmaker</span></h2>
            <p class="text-center text-muted">Tell us about yourself</p>

            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active">
                    <div class="step-circle">1</div>
                    <div class="step-label">Basic Info</div>
                </div>
                <div class="step-connector"></div>
                <div class="step">
                    <div class="step-circle">2</div>
                    <div class="step-label">Skills</div>
                </div>
            </div>
        </div>

        <!-- Form -->
        <form asp-controller="Account" asp-action="RegisterCrewStepOne" method="post" enctype="multipart/form-data" class="registration-form">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

            <!-- Profile Image Upload -->
            <div class="form-group mb-4 text-center">
                <label class="form-label d-block">Profile Image</label>
                <div class="image-upload-container">
                    <label class="image-preview" id="imagePreview" for="profileImageInput">
                        <span class="placeholder-text">üì∏ Click to upload photo (optional)</span>
                        <img src="~/img/profile/default-profile.png" id="previewImg" style="display: none;" alt="Default profile picture"/>
                    </label>
                    <input type="file"
                           asp-for="ProfilePicturePath"
                           name="ProfilePicturePath"
                           class="form-control d-none"
                           id="profileImageInput"
                           accept="image/*" />
                </div>
            </div>
            
            <div class="row">
                <!-- Username -->
                <div class="form-group mb-3">
                    <label asp-for="UserName" class="form-label"></label>
                    <input asp-for="UserName" class="form-control" placeholder="john.doe" autofocus />
                    <span asp-validation-for="UserName" class="text-danger"></span>
                </div>
                <!-- Email -->
                <div class="form-group mb-3">
                    <label asp-for="Email" class="form-label"></label>
                    <input asp-for="Email" class="form-control" placeholder="john.doe@gmail.com" autofocus />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>
                <!-- Phone number-->
                <div class="form-group mb-3">
                    <label asp-for="PhoneNumber" class="form-label"></label>
                    <input asp-for="PhoneNumber" class="form-control" placeholder="0878123456" autofocus />
                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                </div>
                <!-- Password -->
                <div class="form-group mb-3">
                    <label asp-for="Password" class="form-label"></label>
                    <input type="password" asp-for="Password" class="form-control" placeholder="Strong password" autofocus />
                    <span asp-validation-for="Password" class="text-danger"></span>
                </div>
            </div>
            
            <div class="row">
                <!-- First Name -->
                <div class="form-group mb-3">
                    <label asp-for="FirstName" class="form-label"></label>
                    <input asp-for="FirstName" class="form-control" placeholder="John" autofocus />
                    <span asp-validation-for="FirstName" class="text-danger"></span>
                </div>
                <!-- Last Name -->
                <div class="form-group mb-3">
                    <label asp-for="LastName" class="form-label"></label>
                    <input asp-for="LastName" class="form-control" placeholder="Doe" />
                    <span asp-validation-for="LastName" class="text-danger"></span>
                </div>
            </div>
            
            <!-- Nickname -->
            <div class="form-group mb-3">
                <label asp-for="Nickname" class="form-label"></label>
                <input asp-for="Nickname" class="form-control" placeholder="JD (Optional)" />
                <span asp-validation-for="Nickname" class="text-danger"></span>
            </div>
            
            <!-- Biography -->
            <div class="form-group mb-4">
                <label asp-for="Biography" class="form-label"></label>
                <textarea asp-for="Biography"
                          class="form-control"
                          rows="5"
                          placeholder="Share your experience, passion for filmmaking, and what drives you as a creator..."
                          maxlength="4000"></textarea>
                <span asp-validation-for="Biography" class="text-danger"></span>
                <small class="form-text text-muted">
                    <span id="bioCharCount">0</span> / 4000 characters
                </small>
            </div>

            <!-- Actions -->
            <div class="d-flex justify-content-between">
                <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
                    ‚Üê Back to Home
                </a>
                <button type="submit" class="btn btn-wrap-primary">
                    Next Step ‚Üí
                </button>
            </div>
        </form>
    </div>
</div>
</section>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Character counter for biography
        $(document).ready(function() {
            const bioField = $('#Biography');
            const counter = $('#bioCharCount');

            bioField.on('input', function() {
                counter.text($(this).val().length);
            });

            // Initialize
            counter.text(bioField.val().length);
        });
    </script>
    
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("profileImageInput");
  const img = document.getElementById("previewImg");
  const preview = document.getElementById("imagePreview");
  const placeholder = preview?.querySelector(".placeholder-text");

  if (!input || !img || !preview) return;

  input.addEventListener("change", () => {
      const file = input.files && input.files[0];
      if (!file) {
          img.style.display = "none";
          preview.classList.remove("has-image");
          if (placeholder) placeholder.style.display = "";
          return;
      }

      if (file.size > @MaxFileSize) {
          alert("File size must be less than 5MB.");
          input.value = "";
          return;
      }

      const url = URL.createObjectURL(file);
      img.src = url;
      img.style.display = "block";
      preview.classList.add("has-image");
      if (placeholder) placeholder.style.display = "none";
  });
});
    </script>
}
