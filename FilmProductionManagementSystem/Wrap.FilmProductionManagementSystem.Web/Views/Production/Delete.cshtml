@using Wrap.ViewModels.Production;

@using static Wrap.ViewModels.General.Helper.ProductionStatusAbstraction;

@model DeleteProductionViewModel

@{
    ViewData["Title"] = "Delete Production";
}

<link rel="stylesheet" href="~/css/production.css" asp-append-version="true" />

<div class="production-wrapper">
    <div class="container">

        @* ── Danger Header ── *@
        <div class="production-header-card text-center">
            <i class="bi bi-exclamation-triangle-fill"
               style="font-size:2.5rem; color:#e53935;"></i>
            <h2 class="fw-bold mt-3 mb-1" style="color:#c62828;">Delete Production</h2>
            <p class="text-muted mb-0">This action is permanent and cannot be undone.</p>
        </div>

        <div class="row g-4">

            @* ── Left: Production preview ── *@
            <div class="col-lg-5">
                <div class="section-card h-100">
                    <div class="section-header">
                        <i class="bi bi-film me-2"></i>
                        <h3>Production to Delete</h3>
                    </div>

                    <img src="@Model.Thumbnail" alt="@Model.Title"
                         class="production-thumbnail mb-4">

                    <h4 class="fw-bold mb-3" style="color:var(--wrap-dark-blue);">@Model.Title</h4>

                    <div class="info-item">
                        <div class="info-label">Status</div>
                        <div class="info-value">
                            <span class="status-badge status-default">@GetDisplayName(Model.StatusType)</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Budget</div>
                        <div class="info-value">@Model.Budget</div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <div class="info-item">
                            <div class="info-label">Description</div>
                            <div class="info-value text-muted" style="font-size:0.95rem;">
                                @Model.Description
                            </div>
                        </div>
                    }
                </div>
            </div>

            @* ── Right: Warnings + Confirm ── *@
            <div class="col-lg-7 d-flex flex-column gap-4">

                @* Associated data warning *@
                <div class="danger-zone-card">
                    <div class="section-header">
                        <i class="bi bi-database-exclamation me-2"></i>
                        <h3>Associated Data</h3>
                    </div>

                    <p class="text-muted mb-3">
                        The following data is linked to this production.
                        Deleting it will remove all associations — but will <strong>not</strong> delete
                        the crew, cast, or scenes themselves.
                    </p>

                    <div class="associated-data-item">
                        <i class="bi bi-people-fill"></i>
                        <div class="flex-grow-1">Crew Members</div>
                        <span class="associated-count">@Model.CrewMembersCount</span>
                    </div>
                    <div class="associated-data-item">
                        <i class="bi bi-person-video3"></i>
                        <div class="flex-grow-1">Cast Members</div>
                        <span class="associated-count">@Model.CastMembersCount</span>
                    </div>
                    <div class="associated-data-item">
                        <i class="bi bi-camera-video-fill"></i>
                        <div class="flex-grow-1">Scenes</div>
                        <span class="associated-count">@Model.ScenesCount</span>
                    </div>

                    @if (Model.CrewMembersCount > 0 || Model.CastMembersCount > 0 || Model.ScenesCount > 0)
                    {
                        <div class="alert alert-warning mt-3 mb-0 d-flex gap-2 align-items-center">
                            <i class="bi bi-exclamation-triangle-fill flex-shrink-0"></i>
                            <span>All associations above will be permanently removed.</span>
                        </div>
                    }
                </div>

                @* Final confirmation ── *@
                <div class="section-card">
                    <div class="section-header">
                        <i class="bi bi-shield-exclamation me-2"></i>
                        <h3>Confirm Deletion</h3>
                    </div>

                    <p class="text-muted mb-4">
                        Type <strong class="text-danger">DELETE</strong> below to confirm you want to
                        permanently remove <strong>@Model.Title</strong>.
                    </p>

                    <div class="mb-4">
                        <input type="text" id="confirmInput" class="form-control form-control-lg"
                               placeholder="Type DELETE to confirm"
                               autocomplete="off" />
                    </div>

                    <form asp-action="Delete" asp-route-productionId="@Model.Id" method="post">
                        @Html.AntiForgeryToken()

                        <div class="d-flex justify-content-between flex-wrap gap-3">
                            <a asp-action="Details" asp-route-productionId="@Model.Id"
                               class="btn btn-production-secondary btn-lg">
                                <i class="bi bi-arrow-left me-2"></i>Cancel, Keep It
                            </a>
                            <button type="submit" class="btn btn-production-danger btn-lg"
                                    id="deleteButton" disabled>
                                <i class="bi bi-trash-fill me-2"></i>Yes, Delete Permanently
                            </button>
                        </div>
                    </form>
                </div>

            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const confirmInput = document.getElementById('confirmInput');
            const deleteButton = document.getElementById('deleteButton');

            // Enable delete button only when user types "DELETE"
            confirmInput?.addEventListener('input', () => {
                const ready = confirmInput.value.trim() === 'DELETE';
                deleteButton.disabled = !ready;
                confirmInput.classList.toggle('border-danger', !ready && confirmInput.value.length > 0);
                confirmInput.classList.toggle('border-success', ready);
            });

            // Extra JS-level confirmation on submit
            deleteButton?.closest('form')?.addEventListener('submit', e => {
                if (confirmInput.value.trim() !== 'DELETE') {
                    e.preventDefault();
                    return;
                }
                if (!confirm('Final check: Are you absolutely sure you want to delete this production?')) {
                    e.preventDefault();
                }
            });

            // Entrance animation
            document.querySelectorAll('.production-header-card, .section-card, .danger-zone-card')
                .forEach((el, i) => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(20px)';
                    el.style.transition = 'all 0.4s ease';
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }, i * 100);
                });
        });
    </script>
}
